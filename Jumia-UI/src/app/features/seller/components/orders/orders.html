<div class="orders">
  <div class="header d-flex justify-content-between align-items-center">
    <div class="page-header">
      <h2><i class="fas fa-clipboard-list"></i> Orders Management</h2>
      <p>Manage and track all your customer orders</p>
    </div>

    <div class="orders-controls">
      <div class="search-box">
        <input
          type="text"
          placeholder="Search orders..."
          [(ngModel)]="searchTerm"
          (input)="filterOrders()">
      </div>

      <div class="filter-box">
        <select [(ngModel)]="selectedStatus" (change)="filterOrders()">
          <option value="all"><i class="fas fa-list"></i> All Orders</option>
          <option value="pending"><i class="fas fa-clock"></i> Pending</option>
          <option value="confirmed"><i class="fas fa-check"></i> Confirmed</option>
          <option value="shipped"><i class="fas fa-shipping-fast"></i> Shipped</option>
          <option value="delivered"><i class="fas fa-box-check"></i> Delivered</option>
          <option value="cancelled"><i class="fas fa-times-circle"></i> Cancelled</option>
        </select>
      </div>
    </div>
  </div>

  <div class="orders-stats">
    <div class="stat-item">
      <span class="stat-number">{{subOrders?.length}}</span>
      <span class="stat-label"><i class="fas fa-list-ol"></i> Total Orders</span>
    </div>
    <div class="stat-item">
      <span class="stat-number">{{pending?.length}}</span>
      <span class="stat-label"><i class="fas fa-clock"></i> Pending</span>
    </div>
    <div class="stat-item">
      <span class="stat-number">{{shipped?.length}}</span>
      <span class="stat-label"><i class="fas fa-shipping-fast"></i> Shipped</span>
    </div>
    <div class="stat-item">
      <span class="stat-number">{{delivered?.length}}</span>
      <span class="stat-label"><i class="fas fa-box-check"></i> Delivered</span>
    </div>
    <div class="stat-item">
      <span class="stat-number">{{confirmed?.length}}</span>
      <span class="stat-label"><i class="fas fa-check-circle"></i> Confirmed</span>
    </div>
    <div class="stat-item">
      <span class="stat-number">{{canceled?.length}}</span>
      <span class="stat-label"><i class="fas fa-times-circle"></i> Canceled</span>
    </div>
  </div>

  <div class="orders-table">
    <table>
      <thead>
        <tr>
          <th class="text-center"><i class="fas fa-list-ol"></i> Items Count</th>
          <th class="text-center"><i class="fas fa-money-bill-wave"></i> Amount</th>
          <th class="text-center"><i class="fas fa-info-circle"></i> Status</th>
          <th class="text-center"><i class="fas fa-calendar-alt"></i> Order Date</th>
          <th class="text-center"><i class="fas fa-cogs"></i> Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of paginatedOrders">
          <td class="text-center">{{ order?.orderItems?.length }}</td>
          <td class="amount text-center">EGP{{order?.subtotal | number:'1.2-2'}}</td>
          <td class="text-center">
            <span class="status-badge text-center" [class]="getStatusClass(order.status)">
              {{order.status | titlecase}}
            </span>
          </td>
          <td class="text-center">{{order?.statusUpdatedAt | date:'short'}}</td>
          <td class="text-center">
            <div class="action-buttons d-flex justify-content-center">
              <button
                class="btn-action view"
                title="View Details"
                (click)="openItemsModal(order)">
                <i class="fas fa-eye"></i> Details
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="filteredOrders?.length === 0" class="no-orders">
      <i class="fas fa-inbox fa-3x" style="margin-bottom: 1rem; opacity: 0.5;"></i>
      <p>No orders found matching your criteria.</p>
    </div>

    <div class="pagination-controls" *ngIf="filteredOrders!.length > itemsPerPage">
      <button
        (click)="prevPage()"
        [disabled]="currentPage === 1"
        class="pagination-button">
        Previous
      </button>

      <ng-container *ngFor="let page of pageNumbers">
        <span
          *ngIf="page === 1 && pageNumbers[0] !== 1"
          (click)="goToPage(1)"
          class="page-number">
          1
        </span>
        <span
          *ngIf="page === 1 && pageNumbers[0] > 2"
          class="page-ellipsis">
          ...
        </span>
        <span
          (click)="goToPage(page)"
          [class.active]="page === currentPage"
          class="page-number">
          {{ page }}
        </span>
        <span
          *ngIf="page === pageNumbers[pageNumbers.length - 1] && page < totalPages - 1"
          class="page-ellipsis">
          ...
        </span>
        <span
          *ngIf="page === pageNumbers[pageNumbers.length - 1] && page < totalPages"
          (click)="goToPage(totalPages)"
          class="page-number">
          {{ totalPages }}
        </span>
      </ng-container>

      <button
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
        class="pagination-button">
        Next
      </button>

      <span class="page-info">
        Page {{ currentPage }} of {{ totalPages }} ({{ filteredOrders?.length }} items)
      </span>
    </div>
  </div>

 <div class="modal-overlay" *ngIf="showItemsModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-receipt"></i> Order Items for Order #{{ selectedOrderForItems?.id }}</h3>
          <button class="close-button" (click)="closeItemsModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div *ngIf="selectedOrderForItems && selectedOrderForItems.orderItems.length > 0">
            <table>
              <thead>
                <tr>
                  <th><i class="fas fa-tag"></i> Product Name</th>
                  <th><i class="fas fa-sort-numeric-up"></i> Quantity</th>
                  <th><i class="fas fa-dollar-sign"></i> Unit Price</th>
                  <th><i class="fas fa-calculator"></i> Total</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of selectedOrderForItems.orderItems">
                  <td>{{ item.productName }}</td>
                  <td>{{ item.quantity }}</td>
                  <td>EGP{{ item.priceAtPurchase | number:'1.2-2' }}</td>
                  <td>EGP{{ item.quantity * item.priceAtPurchase | number:'1.2-2' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div *ngIf="!selectedOrderForItems || selectedOrderForItems.orderItems.length === 0" class="no-items-message">
            <i class="fas fa-exclamation-circle"></i>
            <p>No items found for this order.</p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeItemsModal()">
            <i class="fas fa-times"></i> Close
          </button>
        </div>
      </div>
    </div>
</div>
