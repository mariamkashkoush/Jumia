<div class="analytics">
  <div class="page-header">
    <p>Track your store performance and sales metrics</p>
  </div>

  <div *ngIf="isLoading" class="loading-state">
    <i class="fas fa-spinner fa-spin fa-2x"></i>
    <p>Loading analytics data...</p>
  </div>

  <div *ngIf="error" class="error-state">
    <i class="fas fa-exclamation-triangle fa-2x"></i>
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="loadAnalyticsData()">
      <i class="fas fa-sync-alt"></i> Retry
    </button>
  </div>

  <div *ngIf="!isLoading && !error">
    <div class="analytics-grid">
      <div class="chart-card">
        <div class="chart-header">
          <h3><i class="fas fa-chart-area"></i> Sales Overview</h3>
          <div class="chart-controls">
            <div class="period-selector">
              <select [(ngModel)]="selectedPeriod" (change)="updateChartData()">
                <option value="weekly">Weekly</option>
                <option value="monthly" selected>Monthly</option>
                <option value="quarterly">Quarterly</option>
                <option value="yearly">Yearly</option>
              </select>
            </div>
            <div class="chart-type-selector">
              <button (click)="setChartType('line')" [class.active]="chartType === 'line'">
                <i class="fas fa-chart-line"></i>
              </button>
              <button (click)="setChartType('bar')" [class.active]="chartType === 'bar'">
                <i class="fas fa-chart-bar"></i>
              </button>
              <!-- <button (click)="setChartType('pie')" [class.active]="chartType === 'pie'">
                <i class="fas fa-chart-pie"></i>
              </button> -->
              <button class="export-btn" (click)="exportChart()">
                <i class="fas fa-download"></i> Export
              </button>
            </div>
          </div>
        </div>
        <div class="sales-summary">
          <div class="metric">
            <span class="label"><i class="fas fa-calendar-alt"></i> This Month</span>
            <span class="value">{{ formatCurrency(salesData.thisMonth) }}</span>
          </div>
          <div class="metric">
            <span class="label"><i class="fas fa-history"></i> Last Month</span>
            <span class="value">{{ formatCurrency(salesData.lastMonth) }}</span>
          </div>
          <div class="metric growth">
            <span class="label"><i class="fas fa-trending-up"></i> Growth</span>
            <span
              class="value"
              [class.positive]="salesData.growth > 0"
              [class.negative]="salesData.growth < 0"
            >
              <i class="fas" [class.fa-arrow-up]="salesData.growth > 0" [class.fa-arrow-down]="salesData.growth < 0"></i>
              {{ salesData.growth > 0 ? "+" : ""}}{{ formatPercentage(salesData.growth) }}
            </span>
          </div>
        </div>
        <div class="chart-placeholder">
          <canvas id="salesChart"></canvas>
        </div>
      </div>

      <div class="top-products-card">
        <h3><i class="fas fa-trophy"></i> Top Selling Products</h3>
        <div
          class="products-list"
          *ngIf="topProducts.length > 0; else noProducts"
        >
          <div class="product-item" *ngFor="let product of topProducts; let i = index">
            <div class="product-info">
              <h4>
                <i class="fas fa-medal"
                   [style.color]="i === 0 ? '#FFD700' : (i === 1 ? '#C0C0C0' : '#CD7F32')"></i>
                {{ product.name }}
              </h4>
              <p><i class="fas fa-cube"></i> {{ product.sales }} units sold</p>
            </div>
            <div class="product-revenue">
              {{ formatCurrency(product.revenue) }}
            </div>
          </div>
        </div>
        <ng-template #noProducts>
          <div class="no-data">
            <i class="fas fa-chart-pie fa-2x"></i>
            <p>No sales data available yet</p>
          </div>
        </ng-template>
      </div>
    </div>

    <div class="metrics-row">
      <div class="metric-card">
        <div class="metric-icon">
          <i class="fas fa-shopping-cart"></i>
        </div>
        <h4><i class="fas fa-list-ol"></i> Total Orders</h4>
        <div class="metric-value">{{ metrics.totalOrders }}</div>
      </div>
      <div class="metric-card">
        <div class="metric-icon">
          <i class="fas fa-money-bill-wave"></i>
        </div>
        <h4><i class="fas fa-chart-line"></i> Total Revenue</h4>
        <div class="metric-value">
          {{ formatCurrency(metrics.totalRevenue) }}
        </div>
      </div>
      <div class="metric-card">
        <div class="metric-icon">
          <i class="fas fa-box-open"></i>
        </div>
        <h4><i class="fas fa-check-circle"></i> Active Products</h4>
        <div class="metric-value">{{ metrics.activeProducts }}</div>
      </div>
      <div class="metric-card">
        <div class="metric-icon">
          <i class="fas fa-calculator"></i>
        </div>
        <h4><i class="fas fa-percentage"></i> Average Order Value</h4>
        <div class="metric-value">
          {{ formatCurrency(metrics.averageOrderValue) }}
        </div>
      </div>
      <div class="metric-card">
        <div class="metric-icon">
          <i class="fas fa-undo"></i>
        </div>
        <h4><i class="fas fa-exchange-alt"></i> Return Rate</h4>
        <div class="metric-value">
          {{ formatPercentage(metrics.returnRate) }}
        </div>
      </div>
      <div class="metric-card">
        <div class="metric-icon">
          <i class="fas fa-mouse-pointer"></i>
        </div>
        <h4><i class="fas fa-bullseye"></i> Conversion Rate</h4>
        <div class="metric-value">
          {{ formatPercentage(metrics.conversionRate) }}
        </div>
      </div>
    </div>
  </div>
</div>
